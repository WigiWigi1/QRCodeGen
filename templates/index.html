<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ColorQR: Scan Confidence. Print Perfect.</title>
  <meta name="description" content="Create beautiful, scannable QR codes for your brand. Get vector SVG print quality, guaranteed contrast, dynamic QR codes, and logo embedding with ColorQR." />

  <link rel="icon" type="image/png" href="/static/favicon.png" />
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/iro.min.js"></script>
  <link rel="canonical" href="https://colorqr.app/" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">

  <style>
    /* 1. –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –≤–Ω–∏–∑—É */
    .features-section {
        max-width: 980px;
        margin: 3rem auto 40px;
        padding: 0 14px;
        text-align: center;
    }
    .features-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin-top: 2rem;
        text-align: left;
    }
    .feature-hint {
        padding: 1rem;
        border-radius: 12px;
        background: #fff;
        border: 1px solid #e5e7eb;
        box-shadow: 0 2px 6px rgba(0,0,0,.04);
    }
    .feature-hint h4 {
        margin: 0 0 0.25rem;
        font-size: 1.05rem;
        font-weight: 600;
        color: #1d4ed8;
    }
    .feature-hint p {
        margin: 0;
        font-size: 0.95rem;
        color: #4b5563;
    }
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –Ω–∏–∂–Ω–µ–π —Å–µ–∫—Ü–∏–∏ */
    @media (max-width: 768px) {
        .features-grid { grid-template-columns: 1fr; }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è Hero-—Ç–µ–∫—Å—Ç–∞ */
    .hero-text-container h1 {
        font-size: 1.8rem;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        color: #111827;
        text-align: center;
    }
    .hero-text-container p {
        font-size: 1.05rem;
        color: #4b5563;
        margin-bottom: 1.5rem;
        text-align: center;
    }
  </style>

</head>
<body>
  <div class="header">
    <div class="logo">
      <a href="/" class="logo-link">ColorQR</a>
      {% if is_pro %}
        <span class="badge badge-pro" title="Pro active">Pro</span>
      {% elif is_one_time %}
        <span class="badge badge-ot" title="One-Time Access active">One-Time</span>
      {% endif %}
    </div>
    <div class="user-box">
      {% if user %}
        {% if user.picture %}<img src="{{ user.picture }}" alt="avatar">{% endif %}
        <span class="user-email">{{ user.email }}</span>
        <a class="logout-btn" href="/logout">Logout</a>
      {% else %}
        <a class="login-btn" href="/login">Login with Google</a>
      {% endif %}
    </div>
  </div>

  <nav>
    <a href="/"        class="{{ 'active' if active=='home'    else '' }}">Home</a>
    <a href="/about"   class="{{ 'active' if active=='about'   else '' }}">About</a>
    <a href="/pricing" class="{{ 'active' if active=='pricing' else '' }}">Pricing</a>
    <a href="/faq"     class="{{ 'active' if active=='faq'     else '' }}">FAQ</a>
    <a href="/blog"    class="{{ 'active' if active=='blog'    else '' }}">Blog</a>
    <a href="/contact" class="{{ 'active' if active=='contact' else '' }}">Contact</a>
  </nav>

  <div class="card" id="card">
    <div class="columns" id="cols">
      <div class="generator">
        <h2>QR Code Generator</h2>

        <div class="type-tabs" role="tablist" aria-label="QR types">
          <label class="seg"><input type="radio" name="qrtype" value="url"  checked><span>URL</span></label>
          <label class="seg"><input type="radio" name="qrtype" value="wifi"><span>Wi-Fi</span></label>
          <label class="seg"><input type="radio" name="qrtype" value="text"><span>Text</span></label>
          {% if show_vcard %}
            <label class="seg"><input type="radio" name="qrtype" value="vcard"><span>vCard</span></label>
            <label class="seg"><input type="radio" name="qrtype" value="dynamic"><span>Dynamic</span></label>
          {% endif %}
        </div>

        <div id="form-url" class="form-section">
          <input id="link" type="text" placeholder="Enter link (we'll add https:// if missing)">
          <div id="err" class="error">Please enter a link</div>
        </div>

        <div id="form-wifi" class="form-section" hidden>
          <label for="wifi-ssid">Wi-Fi SSID</label>
          <input id="wifi-ssid" type="text" placeholder="Network name">

          <label for="wifi-pass">Password</label>
          <input id="wifi-pass" type="text" placeholder="Leave empty for open network">

          <label for="wifi-enc">Encryption</label>
          <select id="wifi-enc">
            <option value="WPA" selected>WPA/WPA2</option>
            <option value="WPA3">WPA3</option>
            <option value="WEP">WEP</option>
            <option value="nopass">No password</option>
          </select>

          <div id="err-wifi" class="error">Please enter SSID</div>
          <div class="note-lock" style="margin-top:.25rem;color:#6b7280;">
            Wi-Fi codes include a small center icon automatically.
          </div>
        </div>

        <div id="form-text" class="form-section" hidden>
          <textarea id="plain-text" rows="4" placeholder="Your text to encode"></textarea>
          <div id="err-text" class="error">Please enter text</div>
        </div>

        {% if show_vcard %}
        <div id="form-vcard" class="form-section" hidden>
          <label for="vc-name">Full name</label>
          <input id="vc-name" type="text" placeholder="e.g., Jane Doe">

          <label for="vc-title">Title (optional)</label>
          <input id="vc-title" type="text" placeholder="e.g., Product Manager">

          <label for="vc-phone">Phone</label>
          <input id="vc-phone" type="text" placeholder="+420 777 123 456">

          <label for="vc-email">Email</label>
          <input id="vc-email" type="email" placeholder="name@company.com">

          <label for="vc-org">Company (optional)</label>
          <input id="vc-org" type="text" placeholder="Company s.r.o.">

          <label for="vc-url">Website (optional)</label>
          <input id="vc-url" type="text" placeholder="https://example.com">

          <div id="err-vcard" class="error">Please enter at least a name or email</div>
        </div>
        {% endif %}

        {% if show_dynamic %}
        <div id="form-dynamic" class="form-section" hidden>
          <label for="dyn-url">Target URL</label>
          <input id="dyn-url" type="text" placeholder="https://destination.com/page">
          <div id="err-dyn" class="error">Please enter a URL</div>
          <div class="note-lock" style="margin-top:.25rem;color:#6b7280;">
            You can update the target anytime in your dashboard (coming soon).
          </div>
        </div>
        {% endif %}

        {% if is_pro %}
        <div id="custom-icon-uploader" class="form-section" hidden>
          <label class="label">Center icon (vCard)</label>
          <div id="icon-drop" class="uploader" role="button" tabindex="0" aria-label="Upload PNG icon">
            <div class="uploader-inner">
              <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M19 14v3a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-3" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M7 10l5-5 5 5M12 5v11" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              <div class="uploader-text">
                <div class="uploader-title">Drag & drop PNG here</div>
                <div class="uploader-sub">or <span class="uploader-link">choose a file</span> (‚â§ 512 KB)</div>
              </div>
              <input id="icon-file" type="file" accept="image/png" hidden>
            </div>
          </div>
          <div id="icon-upload-status" class="uploader-status"></div>
        </div>
        {% endif %}

        <div class="size">
          <label class="seg"><input type="radio" name="sz" value="sm"><span>Small (256px)</span></label>
          <label class="seg"><input type="radio" name="sz" value="md" checked><span>Medium (512px)</span></label>
          {% if is_paid %}
          <label class="seg"><input type="radio" name="sz" value="lg"><span>Large (1024px)</span></label>
          {% endif %}
        </div>

        <h4 style="text-align:center;margin:.5rem 0 0;">Pick a color scheme:</h4>
        <div class="palette">
          <div class="swatch"><button style="background:linear-gradient(45deg,#000000 50%,#ffffff 50%)" onclick="setColors('#000000','#ffffff')"></button>Classic B/W</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#023e8a 50%,#bee1e6 50%)" onclick="setColors('#023e8a','#bee1e6')"></button>Navy / Powder</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#2a9d8f 50%,#f0efeb 50%)" onclick="setColors('#2a9d8f','#f0efeb')"></button>Seafoam / Linen</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#1d4ed8 50%,#dbeafe 50%)" onclick="setColors('#1d4ed8','#dbeafe')"></button>Royal / Soft</div>

          {% if extra_palettes %}
          <div class="swatch"><button style="background:linear-gradient(45deg,#6a0d2d 50%,#fde2e4 50%)" onclick="setColors('#6a0d2d','#fde2e4')"></button>Burgundy / Blush</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#2f5d62 50%,#e2f0cb 50%)" onclick="setColors('#2f5d62','#e2f0cb')"></button>Teal / Mint</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#7c4700 50%,#fff1c1 50%)" onclick="setColors('#7c4700','#fff1c1')"></button>Brown / Cream</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#0f4c5c 50%,#e0fbfc 50%)" onclick="setColors('#0f4c5c','#e0fbfc')"></button>Deep Teal / Ice</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#283618 50%,#dda15e 50%)" onclick="setColors('#283618','#dda15e')"></button>Olive / Sand</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#14213d 50%,#fca311 50%)" onclick="setColors('#14213d','#fca311')"></button>Navy / Amber</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#1b4332 50%,#d8f3dc 50%)" onclick="setColors('#1b4332','#d8f3dc')"></button>Forest / Mint</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#5f0f40 50%,#e0aaff 50%)" onclick="setColors('#5f0f40','#e0aaff')"></button>Purple / Lavender</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#2d00f7 50%,#cdb4db 50%)" onclick="setColors('#2d00f7','#cdb4db')"></button>Indigo / Lilac</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#006d77 50%,#edf6f9 50%)" onclick="setColors('#006d77','#edf6f9')"></button>Teal / Soft Blue</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#582f0e 50%,#ffe5b4 50%)" onclick="setColors('#582f0e','#ffe5b4')"></button>Coffee / Beige</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#5a189a 50%,#e0aaff 50%)" onclick="setColors('#5a189a','#e0aaff')"></button>Violet / Lavender</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#264653 50%,#e9c46a 50%)" onclick="setColors('#264653','#e9c46a')"></button>Blue Gray / Yellow</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#9d0208 50%,#ffb4a2 50%)" onclick="setColors('#9d0208','#ffb4a2')"></button>Crimson / Coral</div>
          <div class="swatch"><button style="background:linear-gradient(45deg,#03045e 50%,#ade8f4 50%)" onclick="setColors('#03045e','#ade8f4')"></button>Deep Blue / Sky</div>

          <div class="swatch custom-color">
            <button id="custom-color-btn" style="background:linear-gradient(45deg,#4b5563 50%,#f3f4f6 50%);border:1px dashed #9ca3af;"></button>Custom color
            <input id="custom-color-input" type="color" hidden>
          </div>
          {% endif %}
        </div>

        <button id="genBtn" onclick="onGenerateClick()">Generate</button>
      </div>

      <div class="preview" id="preview">
        <div class="qr-box" id="result" style="min-height:320px"></div>
        <div id="downloads" class="downloads">
          <a id="dl-jpg" href="#" download>JPG</a>
          {% if is_pro %}
          <a id="dl-svg" href="#" download>SVG</a>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="hero-text-container">
        <h1>ColorQR: Scan Confidence. Print Perfect.</h1>
        <p>Create beautiful, scannable QR codes for your brand. Get vector SVG print quality and essential pro tools that guarantee readability.</p>
        <div style="margin-bottom: 1rem; text-align: center;">
            <a class="login-btn" href="/pricing" style="background: #10b981;">See Pro Features</a>
        </div>
    </div>
  </div>
  <div id="customColorModal" class="modal-backdrop" style="display:none;">
    <div class="modal-content">
        <h4>üé® Custom Color Selector</h4>

        <div class="color-picker-row">
            <div class="color-picker-column">
                <label for="fillColorPicker">QR Color</label>
                <div id="fillColorContainer" class="picker-container"></div>
                <div class="hex-input-wrapper">
                    <span id="fillColorSwatch" class="color-swatch-indicator"></span>
                    <input type="text" id="fillHexValue" value="#000000" maxlength="7" pattern="#[0-9A-Fa-f]{6}">
                </div>
            </div>

            <div class="color-picker-column">
                <label for="backColorPicker">Background Color</label>
                <div id="backColorContainer" class="picker-container"></div>
                <div class="hex-input-wrapper">
                    <span id="backColorSwatch" class="color-swatch-indicator"></span>
                    <input type="text" id="backHexValue" value="#ffffff" maxlength="7" pattern="#[0-9A-Fa-f]{6}">
                </div>
            </div>
        </div>

        <div id="contrast-panel" class="contrast-panel contrast-safe">
            <div class="contrast-ratio">Ratio: <span id="contrast-ratio-value">1:1</span></div>
            <div id="contrast-status-message" class="status-message">Requires contrast ratio ‚â• 4.5:1</div>
        </div>

        <div class="modal-actions">
            <button id="applyCustomColors" class="btn btn-primary" disabled>Apply Colors</button>
            <button id="closeCustomColors" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>
    <script>
    let selectedFill = "#000000";
    let selectedBack = "#ffffff";
    let typingTimer = null;
    let hasGenerated = false;

    // --- –î–û–ë–ê–í–õ–ï–ù–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø iRo.js –∏ Modal ---
    let fillColorPicker, backColorPicker;
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ DOM
    const modal = document.getElementById('customColorModal');
    const applyBtn = document.getElementById('applyCustomColors');
    const closeBtn = document.getElementById('closeCustomColors');
    // ---

    function setColors(fill, back) {
      selectedFill = fill; selectedBack = back;
      const btn = document.getElementById('custom-color-btn');
      if (btn) btn.style.background = `linear-gradient(45deg, ${fill} 50%, ${back} 50%)`;
      if (hasGenerated) debounceGenerate();
    }
    function getSize() {
      const el = document.querySelector('input[name="sz"]:checked');
      return el ? el.value : 'md';
    }
    // ... (–û—Å—Ç–∞–ª—å–Ω—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –≤–∫–ª—é—á–∞—è buildData, generateQR, debounceGenerate, –∏ —Ç.–¥. –û–°–¢–ê–Æ–¢–°–Ø –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) ...
    function withProto(url) {
      const v = (url || '').trim(); if (!v) return '';
      const low = v.toLowerCase();
      if (low.startsWith('http://') || low.startsWith('https://')) return v;
      return 'https://' + v;
    }
    function showError(id,msg){
      const e=document.getElementById(id); if(!e) return;
      e.textContent=msg||e.textContent; e.style.display='block';
    }
    function clearError(id){
      const e=document.getElementById(id); if(!e) return;
      e.style.display='none';
    }
    function currentType(){
      const el = document.querySelector('input[name="qrtype"]:checked');
      return el ? el.value : 'url';
    }
    function switchForms(){
      const t = currentType();
      document.getElementById('form-url').hidden   = t!=='url';
      document.getElementById('form-wifi').hidden  = t!=='wifi';
      document.getElementById('form-text').hidden  = t!=='text';
      const vc = document.getElementById('form-vcard'); if (vc) vc.hidden = t!=='vcard';
      const dy = document.getElementById('form-dynamic'); if (dy) dy.hidden = t!=='dynamic';

      const up = document.getElementById('custom-icon-uploader');
      if (up) up.hidden = !(t === 'vcard');

      document.getElementById('result').innerHTML = '';
      document.getElementById('downloads').style.display = 'none';
    }

    function buildVCard(){
      const name = document.getElementById('vc-name').value.trim();
      const title= document.getElementById('vc-title').value.trim();
      const phone= document.getElementById('vc-phone').value.trim();
      const email= document.getElementById('vc-email').value.trim();
      const org  = document.getElementById('vc-org').value.trim();
      const url  = document.getElementById('vc-url').value.trim();
      if (!name && !email && !phone) {
        showError('err-vcard','Please enter at least a name, email or phone');
        return { ok:false };
      }
      clearError('err-vcard');
      const lines = [
        'BEGIN:VCARD',
        'VERSION:3.0',
        name ? `N:;${name};;;` : '',
        name ? `FN:${name}` : '',
        title? `TITLE:${title}` : '',
        phone? `TEL:${phone}` : '',
        email? `EMAIL:${email}` : '',
        org  ? `ORG:${org}` : '',
        url  ? `URL:${url}` : '',
        'END:VCARD'
      ].filter(Boolean).join('\n');
      return { ok:true, data: lines, data_type:'vcard' };
    }

    function buildData(){
      const t = currentType();
      if (t === 'wifi') {
        const ssid = document.getElementById('wifi-ssid').value.trim();
        const pass = document.getElementById('wifi-pass').value.trim();
        const enc  = document.getElementById('wifi-enc').value;
        if (!ssid) { showError('err-wifi','Please enter SSID'); return { ok:false }; }
        if ((enc === 'WPA' || enc === 'WPA3' || enc === 'WEP') && !pass) {
          showError('err-wifi','Password required for ' + enc); return { ok:false };
        }
        clearError('err-wifi');
        const encPart = enc === 'nopass' ? 'nopass' : enc;
        const passPart = enc === 'nopass' ? '' : `;P:${pass}`;
        return { ok:true, data:`WIFI:T:${encPart};S:${ssid}${passPart};;`, data_type:'wifi' };
      } else if (t === 'text') {
        const txt = document.getElementById('plain-text').value.trim();
        if (!txt) { showError('err-text','Please enter text'); return { ok:false }; }
        clearError('err-text');
        return { ok:true, data: txt, data_type:'text' };
      } else if (t === 'vcard') {
        return buildVCard();
      } else if (t === 'dynamic') {
        const url = document.getElementById('dyn-url').value.trim();
        if (!url) { showError('err-dyn','Please enter a URL'); return { ok:false }; }
        clearError('err-dyn');
        return { ok:true, data: withProto(url), data_type:'dynamic' };
      } else {
        const raw = document.getElementById('link').value.trim();
        if (!raw) { showError('err','Please enter a link'); return { ok:false }; }
        clearError('err');
        return { ok:true, data: withProto(raw), data_type:'url' };
      }
    }

    async function onGenerateClick() {
      const built = buildData();
      if (!built.ok) return;

      if (!hasGenerated) {
        document.getElementById('card').classList.add('wide');
        document.getElementById('cols').classList.add('twocols');
      }

      await generateQR(built);
      hasGenerated = true;
      document.getElementById('preview').style.display = 'flex';
    }

    async function generateQR(built) {
      const payload = built || buildData();
      if (!payload.ok) return;

      const res = await fetch('/generate_qr', {
        method: 'POST', headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          data: payload.data,
          data_type: payload.data_type,
          fill_color: selectedFill,
          back_color: selectedBack,
          size: getSize()
        })
      });
      const data = await res.json();
      const result = document.getElementById('result');
      const downloads = document.getElementById('downloads');

      if (data.qr_code && data.id) {
        result.innerHTML = `<img src="data:image/jpeg;base64,${data.qr_code}" alt="QR Code">`;
        document.getElementById('dl-jpg').href = `/download_jpg?id=${data.id}`;
        const svg = document.getElementById('dl-svg');
        if (svg) svg.href = `/download_svg?id=${data.id}`;
        downloads.style.display = 'flex';
      } else {
        downloads.style.display = 'none';
        result.innerHTML = `<p style="color:red">${data.error || 'Error'}</p>`;
      }
    }

    function debounceGenerate(){
      if (!hasGenerated) return;
      clearTimeout(typingTimer);
      typingTimer = setTimeout(()=>generateQR(), 400);
    }


    // --- –õ–û–ì–ò–ö–ê COLOR PICKER –ò IRO.JS ---

    // --- 1. –§–£–ù–ö–¶–ò–Ø –ü–†–û–í–ï–†–ö–ò –ö–û–ù–¢–†–ê–°–¢–ê –ß–ï–†–ï–ó API ---
    async function checkContrast(fill, back) {
        const res = await fetch('/api/check_contrast', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fill_color: fill, back_color: back })
        });
        const data = await res.json();
        return data.safe;
    }

    // --- 2. –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø UI –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è IRO) ---
    async function updateModalUI() {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–∏–∫–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
        if (!fillColorPicker || !backColorPicker) return;

        const fill = fillColorPicker.color.hexString;
        const back = backColorPicker.color.hexString;
        const contrastPanel = document.getElementById('contrast-panel');
        const ratioValue = document.getElementById('contrast-ratio-value');
        const statusMsg = document.getElementById('contrast-status-message');
        const fillHexInput = document.getElementById('fillHexValue');
        const backHexInput = document.getElementById('backHexValue');

        const fillSwatch = document.getElementById('fillColorSwatch');
        const backSwatch = document.getElementById('backColorSwatch');

        fillHexInput.style.borderLeftColor = fill;
        backHexInput.style.borderLeftColor = back;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
        fillHexInput.value = fill;
        backHexInput.value = back;

        const contrastSafe = await checkContrast(fill, back);

        const luminance = (c) => {
            const hex = c.substring(1);
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            return (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
        };
        const L1 = luminance(fill);
        const L2 = luminance(back);
        const ratio = (Math.max(L1, L2) + 0.05) / (Math.min(L1, L2) + 0.05);
        ratioValue.textContent = ratio.toFixed(2) + ':1';


        fillSwatch.style.backgroundColor = fill;
        backSwatch.style.backgroundColor = back;
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
        fillHexInput.value = fill;
        backHexInput.value = back;


        if (contrastSafe) {
            contrastPanel.classList.remove('contrast-warning');
            contrastPanel.classList.add('contrast-safe');
            statusMsg.textContent = 'High Contrast. Scanning Guaranteed (‚â• 4.5:1).';
            applyBtn.disabled = false;
        } else {
            contrastPanel.classList.remove('contrast-safe');
            contrastPanel.classList.add('contrast-warning');
            statusMsg.textContent = 'Low Contrast! Scanning Reliability May Be Poor (< 4.5:1).';
            applyBtn.disabled = true;
        }
    }

    // --- 3. Custom color trigger (Paid) ---
    (function(){
        const customTile = document.querySelector('.swatch.custom-color');
        if (!customTile) return;

        // 3.1. –ö–ª–∏–∫ –Ω–∞ –ø–ª–∏—Ç–∫—É "Custom color..."
        customTile.addEventListener('click', (e) => {
            e.preventDefault();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.style.display = 'flex';

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º iRo.js, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏
            if (!fillColorPicker) {
                // –ü–ï–†–í–û–ï –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø: –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–∏–∫–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
                fillColorPicker = new iro.ColorPicker('#fillColorContainer', {
                    width: 180,
                    color: selectedFill,
                    layoutDirection: 'vertical'
                });
                backColorPicker = new iro.ColorPicker('#backColorContainer', {
                    width: 180,
                    color: selectedBack,
                    layoutDirection: 'vertical'
                });

                // --- –ü–†–ò–í–Ø–ó–ö–ê –°–õ–£–®–ê–¢–ï–õ–ï–ô IRO.JS (–û–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è) ---
                fillColorPicker.on('color:change', updateModalUI);
                backColorPicker.on('color:change', updateModalUI);
                // -------------------------------------------------------------

                // –°–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –≤–≤–æ–¥–∞ HEX (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∏–∫–µ—Ä–∞)
                document.getElementById('fillHexValue').addEventListener('input', (e) => {
                    const val = e.target.value;
                    if (/^#?([0-9A-Fa-f]{6})$/.test(val)) fillColorPicker.color.set(val);
                });
                document.getElementById('backHexValue').addEventListener('input', (e) => {
                    const val = e.target.value;
                    if (/^#?([0-9A-Fa-f]{6})$/.test(val)) backColorPicker.color.set(val);
                });

                updateModalUI();
            } else {
                // –ï—Å–ª–∏ –ø–∏–∫–µ—Ä—ã —É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö —Ç–µ–∫—É—â–∏–º–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏
                fillColorPicker.color.set(selectedFill);
                backColorPicker.color.set(selectedBack);
                updateModalUI();
            }
        });

        // 3.2. –ó–ê–ö–†–´–¢–ò–ï –ò –ü–†–ò–ú–ï–ù–ï–ù–ò–ï (Modal Listeners)
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        applyBtn.addEventListener('click', () => {
            const finalFill = fillColorPicker.color.hexString;
            const finalBack = backColorPicker.color.hexString;

            setColors(finalFill, finalBack);
            modal.style.display = 'none';
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∏—Ç–∫–∏ (—á—Ç–æ–±—ã –æ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ)
        const initialFill = selectedFill;
        const initialBack = selectedBack;
        setColors(initialFill, initialBack);
    })();

    // Listeners (–í–∞—à–∞ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
    document.querySelectorAll('input[name="qrtype"]').forEach(r => {
      r.addEventListener('change', () => { switchForms(); });
    });
    document.getElementById('link').addEventListener('input', debounceGenerate);
    const ssid = document.getElementById('wifi-ssid'); if (ssid) ssid.addEventListener('input', debounceGenerate);
    const wpass= document.getElementById('wifi-pass'); if (wpass) wpass.addEventListener('input', debounceGenerate);
    const wenc = document.getElementById('wifi-enc');  if (wenc)  wenc.addEventListener('change', debounceGenerate);
    const ptxt = document.getElementById('plain-text'); if (ptxt) ptxt.addEventListener('input', debounceGenerate);
    const dyn  = document.getElementById('dyn-url'); if (dyn) dyn.addEventListener('input', debounceGenerate);

    // Custom icon upload (–í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∫–æ–Ω–æ–∫)
    (function(){
      const drop = document.getElementById('icon-drop');
      const input = document.getElementById('icon-file');
      const status = document.getElementById('icon-upload-status');
      if (!drop || !input) return;

      const titleEl = drop.querySelector('.uploader-title');
      const subEl   = drop.querySelector('.uploader-sub');
      const linkEl  = drop.querySelector('.uploader-link');

      function setStatus(msg, ok=true){
        status.style.color = ok ? '#6b7280' : '#b91c1c';
        status.textContent = msg || '';
      }

      linkEl.addEventListener('click', (e)=>{
        e.preventDefault(); e.stopPropagation(); input.click();
      });
      drop.addEventListener('click', (e)=>{
        if (e.target.closest('.uploader-link')) return;
        if (e.target.closest('.uploader-inner')) input.click();
      });

      ['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,(e)=>{e.preventDefault(); e.stopPropagation(); drop.classList.add('dragover');}));
      ['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,(e)=>{e.preventDefault(); e.stopPropagation(); drop.classList.remove('dragover');}));
      drop.addEventListener('drop', (e)=>{
        const file = e.dataTransfer.files && e.dataTransfer.files[0];
        if (file) handleFile(file);
      });

      input.addEventListener('change', ()=>{
        const file = input.files && input.files[0];
        if (file) handleFile(file);
      });

      async function handleFile(file){
        if (file.type !== 'image/png') { setStatus('PNG only', false); return; }
        if (file.size > 512*1024)      { setStatus('File too large (max 512 KB)', false); return; }

        setStatus('Uploading...');
        const fd = new FormData(); fd.append('file', file);
        try {
          const res  = await fetch('/upload_icon', { method:'POST', body: fd });
          const data = await res.json();
          if (!res.ok) { setStatus((data && data.error) ? data.error : 'Upload failed', false); return; }

          drop.classList.add('has-file');
          drop.setAttribute('aria-label', 'Selected: ' + (file.name || 'icon.png'));
          titleEl.textContent = file.name || 'icon.png';
          subEl.innerHTML = 'Click to <span class="uploader-link">change file</span> (‚â§ 512 KB)';
          const newLink = drop.querySelector('.uploader-link');
          newLink.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); input.click(); });

          setStatus('Icon uploaded');
          if (hasGenerated) {
            clearTimeout(typingTimer);
            typingTimer = setTimeout(()=>generateQR(), 250);
          }
        } catch(e){
          setStatus('Upload error', false);
        }
      }
    })();


    // Init
    switchForms();
</script>
</body>
</html>